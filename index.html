<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion Massa Wallet</title>
    
    <!-- Import de la bibliothèque massa-web3 -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@massalabs/massa-web3@latest/bundle.js"
    ></script>
    
</head>
<body>
    <h1>Connexion au Portefeuille Massa</h1>
    <button id="connectBtn">Se connecter</button>
    <p id="status">Non connecté</p>

    <script>
        async function connectWallet() {
            try {
                // Vérifier si l'objet Massa est bien chargé
                if (!window.massa) {
                    throw new Error("Massa Web3 non disponible. Vérifiez que Massa Station est installé et actif.");
                }

                console.log("Massa Web3 : ", window.massa);

                // Récupérer le fournisseur de portefeuille
                let provider = (await window.massa.providers(true, 10000))[0];

                if (!provider) {
                    throw new Error("Aucun fournisseur de portefeuille trouvé.");
                }

                // Récupérer les comptes disponibles
                let accounts = await provider.accounts();
                if (accounts.length === 0) {
                    throw new Error("Aucun compte trouvé.");
                }

                // Afficher l'adresse du compte connecté
                document.getElementById("status").innerText = "Connecté : " + accounts[0];
                console.log("Compte connecté :", accounts[0]);

            } catch (error) {
                console.error("Erreur de connexion :", error);
                document.getElementById("status").innerText = "Erreur : " + error.message;
            }
        }

        // Associer le bouton à la fonction de connexion
        document.getElementById("connectBtn").addEventListener("click", connectWallet);
    </script>
</body>
</html>
